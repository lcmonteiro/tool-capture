#!/usr/bin/env python3
# ################################################################################################
# ------------------------------------------------------------------------------------------------
# File:   screenshot.py
# Author: Luis Monteiro
# ------------------------------------------------------------------------------------------------
# ################################################################################################


# #######################################################################################
# ---------------------------------------------------------------------------------------
# main
# ---------------------------------------------------------------------------------------
# #######################################################################################
def main(args=None):
    # --------------------------------------------------------------------------
    # parser arguments
    # --------------------------------------------------------------------------
    from argparse import ArgumentParser
    parser = ArgumentParser()
    parser.add_argument('--monitor', '-m',
        type=int,
        default=0,
        help='monitor')
    parser.add_argument('--begin', '-b',
        type=float,
        nargs=2,
        default=[0.0, 0.0],
        help='begin')
    parser.add_argument('--end', '-e',
        type=float,
        nargs=2,
        default=[0.0, 0.0],
        help='end')
    parser.add_argument('location',
        type=str,
        default="shot.png",
        help='location')
    params = parser.parse_args(args)

    # --------------------------------------------------------------------------
    # process
    # --------------------------------------------------------------------------
    from pyscreenshot import grab
    from screeninfo import get_monitors as monitors
    from time import strftime as formater

    # get montitor information
    monitor = monitors()[params.monitor]

    # screen capture
    grab(bbox=(
        int(monitor.x + params.begin[0] * monitor.width ),
        int(monitor.y + params.begin[1] * monitor.height),
        int(monitor.x + params.end[0]   * monitor.width ),
        int(monitor.y + params.end[1]   * monitor.height),
        )).save(formater(params.location))


# #######################################################################################
# ---------------------------------------------------------------------------------------
# entry point
# ---------------------------------------------------------------------------------------
# #######################################################################################
if __name__ == '__main__':
    from sys import exit
    try:
        exit(main(None))
    except Exception as ex:
        print(f'ERROR: {ex}')
        exit(1)
    except KeyboardInterrupt:
        exit(0)

###################################################################################################
# -------------------------------------------------------------------------------------------------
# end
# -------------------------------------------------------------------------------------------------
###################################################################################################


